#include <iostream>
#include <fstream>
using namespace std;
#include "Manager.h"
#include "Huffman.cpp"
#include "md5.cpp"
#include <stdlib.h>
string http = " http://localhost:3000/GOT/api/";
Manager::Manager(string usr)
{
    username = usr;
}


string getFileContent(string name)
{
    string STRING;
    string content;
	ifstream infile;
    
	infile.open (name);
        while(!infile.eof()) // To get you all the lines.
        {
	        getline(infile,STRING); // Saves the line in STRING.
	        content= content + STRING + "\n";
            //cout<<STRING<<endl; // Prints our STRING.
        }
	infile.close();
    return content;
}
void writeFile(string fileName, string content)
{
    ofstream myfile;
    myfile.open (fileName);
    myfile << content;
    myfile.close();
  
}
string cmdOutput(string cmd) 
{

    string data;
    FILE * stream;
    const int max_buffer = 256;
    char buffer[max_buffer];
    cmd.append(" 2>&1");

    stream = popen(cmd.c_str(), "r");
    if (stream) {
      while (!feof(stream))
        if (fgets(buffer, max_buffer, stream) != NULL) data.append(buffer);
          pclose(stream);
      }
    return data;
}
vector<string> Manager::split(const string& s, char delimiter)
{
   vector<string> tokens;
   string token;
   istringstream tokenStream(s);
   while (std::getline(tokenStream, token, delimiter))
   {
      tokens.push_back(token);
   }
   return tokens;
}
string Manager::decode(string table, string s)
{
	string decodedStr;
	vector<string> charCodes= Manager::split(table, '|');
	string subStr;
	for (int i=0; i< s.size();i++)
	{
		subStr+=s[i];
		for (int j=0; j< charCodes.size();j++)
		{
			vector<string> code= Manager::split(charCodes[j], '~');
			if (subStr==code[1])
			{
				decodedStr+=code[0];
				subStr="";
			}
		}

	}
	//cout<<"decoded: "<<decodedStr<<endl;
	return decodedStr;

} 



vector<string> Manager::encode(string str)
{
	//string str = "Pruebas para ver la codificacion y decodificacion"; 
	string encodedString, decodedString, table; 
	calcFreq(str, str.length()); 
	HuffmanCodes(str.length()); 
	//cout << "Character With their Frequencies:\n"; 
	for (auto v=codes.begin(); v!=codes.end(); v++) 
		//cout << v->first <<' ' << v->second << endl; 
		table= table+ v->first +'~'+ v->second + '|';

	for (auto i: str) 
		encodedString+=codes[i]; 
	//cout << "aaaaa: " << table;

	//cout << "\nEncoded Huffman data:\n" << encodedString << endl; 

	//decodedString = decode_file(minHeap.top(), encodedString); 
	//cout << "\nDecoded Huffman Data:\n" << decodedString << endl; 
	vector<string> vec;
	vec.push_back(table);
	vec.push_back(encodedString);
	//cout << "frecuencias: "<<vec[0]<<endl;
	//cout << "codificado"<<vec[1]<<endl;
	return vec;
	
}
void printStrVec(vector<string> vec)
{
    for(int i=0;i<vec.size();i++)
    {
        cout <<i<<": "<<vec[i] << endl;
    }
}
bool checkForFile(vector<string> fileVec, string fileName)
{
    for(int i=0;i<fileVec.size();i++)
    {
        if (fileVec[i]==fileName){return true;}
    }
    return false;
}
void Manager::init(string name)
{
    string url = http+"init/"+name;
    //auto response = cpr::Post(cpr::Url{url);
    //std::cout << response.text << std::endl; 
    cout << url <<endl;

}
void Manager::help()
{
    cout << getFileContent("help.txt");
}

void Manager::add(string file)
{
    string ignore = getFileContent("gotignore.txt");
    vector<string> ignoreFiles = Manager::split(ignore,'\n');
    if (file == "-A")
    {
        string i;
        i = cmdOutput("ls");
        vector<string> allFiles= Manager::split(i,'\n');
        

        for(int j=0;j<allFiles.size();j++)
        {
            vector<string> temp=Manager::split(allFiles[j],'.');
            if (temp.size()>1)
            {
                if (temp[1]=="txt" && !checkForFile(files,allFiles[j]) && !checkForFile(ignoreFiles,allFiles[j]))
                {
                    files.push_back(allFiles[j]);
                }
            
            }
            
        }
        cout << "Archivos agregados: " <<endl;
        printStrVec(files);
        
    }
    else
    {
        if(!checkForFile(files,file) && !checkForFile(ignoreFiles,file))
        {
            files.push_back(file);
        }
    }
    
}
void Manager::commit(string message)
{
    if (files.empty())
    {
        cout << "Debe agregar archivos, para ver los comandos escriba got help " << endl;
    }
    else
    {
        
        for(int i =0; i<files.size();i++)
        {
            string fileContent = getFileContent(files[i]); //Cada archivo con cambios
            vector <string> fileVec=encode(fileContent);
            string dictionary= fileVec[0];//Diccionario que se crea
            string encodedFile = fileVec[1];//Cambios con huffman
            string url = http+"commit/"+files[i]+"/"+md5(message)+"/"+encodedFile+"/"+ dictionary+"/"+message;
            //auto response = cpr::Post(cpr::Url{url);
            //std::cout << response.text << std::endl; 
            cout << url <<endl;

        }
    }
}
void Manager::status(string file)
{
    string url;
    if (file =="")
    {
        //string out = cmdOutput("diff -q "+file+" ServerFile.txt");
        //if(out=="")
        string temporal = "Archivo1.txt/\n~0001| ~111|'~011100|(~0000110110|)~1001000001|,~0000111|?~1100100|A~100100011|B~100100001|D~00001011|H~0000100|I~110011|J~0000110111|M~1001000000|N~100100111|O~10010010|P~000011010|T~100100010|W~011110|Y~00001100|a~10101|b~00001010|c~1100101|d~10001|e~001|f~0111011|g~00000|h~11011|i~11010|k~011111|l~10000|m~100101|n~0101|o~1011|p~100100110|r~01000|s~10011|t~0110|u~10100|v~0111010|w~11000|y~01001|/0000101100111001011011100010010001000011010101010100010101100101101101000001000100001001011110001111100101101010101111110011111100010011100101110101000100111111000110111010101100111001001111101000110100000011011011000010111101101100101011110100110111010001110001000001111110010110000101110100100011101001010000011110100100100110111100101010011111001011101001011000111001000001110011111110010110101010101110001101111100011010010111101001101110100010001111000010111001111010010100000111011101111010000001101101100001100100011100001000011101101101100111101101101010010100100011001001111011010001111100101101010101111110011111001011101000101000111101111000010111111000110111010101100111001001111110010111010010100100010111101101100101011110100110111010001110001000001111101011000011000101010100110011111011010101011111110100101000001111001111010100010011001100011001000011010001101110100110111010011111000101101010111000110111011010101011111001111101011100010101010011111001010100111110010011001000110101000100100011001001111011000011111101011011011011101101101111010100111110110110101001010010001100100111101101101110110110111101010011111011011010100101001000100001001011110001111000111010100011111100000111100000001011011111011001010000010001011110110110010101111110011111101001001100110001111011010111110111110101101111000111010011011101001111001110111111100000110000100001100100000100001001011110001111000111010100011111100000111100000001011011111011001010000011100100000101111000110000100000000111111110011111011011011110100101011111111110011111011111010110111100000011001000101101100111101100100010100011011011111110101001111111011110101000111010010100000111110100101111010011011101000100011100101001001100110001100100011010110001111110100110011100100111111101110101010100000110100101000001111011010111101001101110100010001110110101101010000010100001000100001101111010010011011011100001010101111010100001101001010000011111010010111110010101001111000010101000010111011100010001100100001101000110111010011011101001110110110111101001010111111110110110111010101101111100111111100101101010101011100011011110011001001000101111011011101010110111011111110100101100011111011011101111110010110101010111101101101110101011011101001101110100111101010100000100011100110111011111010011011101000111000100000111110101111100101101010101111101010110111101011000010000000101111000110000100000000111111110011111110001101010000100001110111011110100000010100010000011110110110111101010011111101101010011111011101000110000110010010010111110010101001111101111000010100011001001001011111001010100111110111100001010001000011011010010000000100111101101101110111010000000110110110100111110100110111010011111001011010101010111000110111100010011100101101110001001100100000100010000100101111000111100011101010001111110000011110000000101101111101100101000001000101111011011001010111111001111110100100110011000111101101011111011111010110111100011101001101110100111100111011111110000011000010000110010011100001100001101011101100010000100101111000111100011101010001111110000011110000000101101111101100101000001110010000010111100011000010000000011111111001111101101101111010010101111111111001111101111101011011110000001000010111011111010011011101001111001100100100010111101101110101011011111000001011100011101000111110001101101010011100100000101111000101110001110100011110000010110101001111101010101100011111001011010110001001111100111010011001011101111101110111011101110000100110001100100100111011111101110100010001001100110000011101000110011000100001011101111101001101110100111100110010010001011110110111010101101111100000101110001110100011111000110110101001110010000010111100010111000111010001111000001011010100111110101010110001111100101101011000100111110011101001100101110111110111011101110111000010011000110010010011101111110111010001000100110011000001110100011001100010000110000110101110110001000010010111100011110001110101000111111000001111000000010110111110110010100000100010111101101100101011111100111111010010011001100011110110101111101111101011011110001110100110111010011110011101111111000001100001000011001001110000110000110101110110000111111010010011010111011000011111101001001101011101100010111100011000010000000011111111011101111000111100011101010001111110000011110000000101101111101100101000001110010000010111101101100101011111100111111010010011001100011110110101111101111101011011110001110100110111010011110011101111111000001100001000011001000001110011111011011011110100101011111111110011111011111010110111100000011100111110110110111101001010111111111100111110111110101101111000000110010001011011001010000011111101010011111100111011100101001011011011110100101000000001110011111100110010011111101001011110100110111010000011100110110111100101110100000011011011011101111111010100001000011110010100100011100111111100010101010101101111101001101110110101111100001010001111011001000101000010001";
        url = http+"status";
        //auto response = cpr::Post(cpr::Url{url);
        //std::cout << response.text << std::endl;
        vector<string> vecResp=Manager::split(temporal, '/');
        vector <string> cambiados;
        vector <string> sinCambio;
        vector <string> eliminados;

        for (int i=0;i<vecResp.size();i+=3)
        {
            cout << "Archivo: "<< vecResp[i] <<endl;
            cout << "Diccionario: "<< vecResp[i+1] <<endl;
            cout << "Contenido: "<< vecResp[i+2] <<endl;
            cout << "-----------------------" <<endl;
            writeFile("ServerFile.txt",decode(vecResp[i+1], vecResp[i+2]));
            string out = cmdOutput("diff -q "+file+" ServerFile.txt");
            if (!checkForFile(files,vecResp[i]))
            {
                eliminados.push_back(vecResp[i]);
            }
            if(out=="")
            {
                sinCambio.push_back(vecResp[i]);
            }
            else
            {
                cambiados.push_back(vecResp[i]);
            }
            
        }
        cout << "Archivos agregados: " <<endl;
        printStrVec(files);
        cout << "Archivos eliminados: " <<endl;
        printStrVec(eliminados);
        cout << "Archivos editados: " <<endl;
        printStrVec(cambiados);

    }
    else
    {
        
        string temporal = "fecha1/Archivo1.txt/commit id1/commitmsj1/\n~0001| ~111|'~011100|(~0000110110|)~1001000001|,~0000111|?~1100100|A~100100011|B~100100001|D~00001011|H~0000100|I~110011|J~0000110111|M~1001000000|N~100100111|O~10010010|P~000011010|T~100100010|W~011110|Y~00001100|a~10101|b~00001010|c~1100101|d~10001|e~001|f~0111011|g~00000|h~11011|i~11010|k~011111|l~10000|m~100101|n~0101|o~1011|p~100100110|r~01000|s~10011|t~0110|u~10100|v~0111010|w~11000|y~01001|/0000101100111001011011100010010001000011010101010100010101100101101101000001000100001001011110001111100101101010101111110011111100010011100101110101000100111111000110111010101100111001001111101000110100000011011011000010111101101100101011110100110111010001110001000001111110010110000101110100100011101001010000011110100100100110111100101010011111001011101001011000111001000001110011111110010110101010101110001101111100011010010111101001101110100010001111000010111001111010010100000111011101111010000001101101100001100100011100001000011101101101100111101101101010010100100011001001111011010001111100101101010101111110011111001011101000101000111101111000010111111000110111010101100111001001111110010111010010100100010111101101100101011110100110111010001110001000001111101011000011000101010100110011111011010101011111110100101000001111001111010100010011001100011001000011010001101110100110111010011111000101101010111000110111011010101011111001111101011100010101010011111001010100111110010011001000110101000100100011001001111011000011111101011011011011101101101111010100111110110110101001010010001100100111101101101110110110111101010011111011011010100101001000100001001011110001111000111010100011111100000111100000001011011111011001010000010001011110110110010101111110011111101001001100110001111011010111110111110101101111000111010011011101001111001110111111100000110000100001100100000100001001011110001111000111010100011111100000111100000001011011111011001010000011100100000101111000110000100000000111111110011111011011011110100101011111111110011111011111010110111100000011001000101101100111101100100010100011011011111110101001111111011110101000111010010100000111110100101111010011011101000100011100101001001100110001100100011010110001111110100110011100100111111101110101010100000110100101000001111011010111101001101110100010001110110101101010000010100001000100001101111010010011011011100001010101111010100001101001010000011111010010111110010101001111000010101000010111011100010001100100001101000110111010011011101001110110110111101001010111111110110110111010101101111100111111100101101010101011100011011110011001001000101111011011101010110111011111110100101100011111011011101111110010110101010111101101101110101011011101001101110100111101010100000100011100110111011111010011011101000111000100000111110101111100101101010101111101010110111101011000010000000101111000110000100000000111111110011111110001101010000100001110111011110100000010100010000011110110110111101010011111101101010011111011101000110000110010010010111110010101001111101111000010100011001001001011111001010100111110111100001010001000011011010010000000100111101101101110111010000000110110110100111110100110111010011111001011010101010111000110111100010011100101101110001001100100000100010000100101111000111100011101010001111110000011110000000101101111101100101000001000101111011011001010111111001111110100100110011000111101101011111011111010110111100011101001101110100111100111011111110000011000010000110010011100001100001101011101100010000100101111000111100011101010001111110000011110000000101101111101100101000001110010000010111100011000010000000011111111001111101101101111010010101111111111001111101111101011011110000001000010111011111010011011101001111001100100100010111101101110101011011111000001011100011101000111110001101101010011100100000101111000101110001110100011110000010110101001111101010101100011111001011010110001001111100111010011001011101111101110111011101110000100110001100100100111011111101110100010001001100110000011101000110011000100001011101111101001101110100111100110010010001011110110111010101101111100000101110001110100011111000110110101001110010000010111100010111000111010001111000001011010100111110101010110001111100101101011000100111110011101001100101110111110111011101110111000010011000110010010011101111110111010001000100110011000001110100011001100010000110000110101110110001000010010111100011110001110101000111111000001111000000010110111110110010100000100010111101101100101011111100111111010010011001100011110110101111101111101011011110001110100110111010011110011101111111000001100001000011001001110000110000110101110110000111111010010011010111011000011111101001001101011101100010111100011000010000000011111111011101111000111100011101010001111110000011110000000101101111101100101000001110010000010111101101100101011111100111111010010011001100011110110101111101111101011011110001110100110111010011110011101111111000001100001000011001000001110011111011011011110100101011111111110011111011111010110111100000011100111110110110111101001010111111111100111110111110101101111000000110010001011011001010000011111101010011111100111011100101001011011011110100101000000001110011111100110010011111101001011110100110111010000011100110110111100101110100000011011011011101111111010100001000011110010100100011100111111100010101010101101111101001101110110101111100001010001111011001000101000010001";
        url = http+"status/"+file;
        //auto response = cpr::Post(cpr::Url{url);
        //std::cout << response.text << std::endl;
        vector<string> vecResp=Manager::split(temporal, '/');
        for(int i=0;i<vecResp.size();i+=6)
        {
            cout << "Archivo: "<< vecResp[i+1] <<endl;
            cout << "Fecha: "<< vecResp[i] <<endl;
            cout << "Commit ID: "<< vecResp[i+2] <<endl;
            cout << "Mensaje: "<< vecResp[i+3] <<endl;
            cout << "Diferencias con el original: "<<endl;
            writeFile("ServerFile.txt",decode(vecResp[i+4], vecResp[i+5]));
            string comando="diff -u " +file + " ServerFile.txt";
            system(comando.c_str());
            //cout << "Diccionario: "<< vecResp[i+4] <<endl;
            //cout << "Contenido: "<< vecResp[i+5] <<endl;
            cout << "-----------------------" <<endl;
        }

    }
    
     
    cout << url <<endl;
}
void Manager::rollback(string file, string commit)
{
    string url = http+"rollback/"+file+"/"+commit;
    //auto response = cpr::Post(cpr::Url{url);
    //std::cout << response.text << std::endl; 
    //vector<string> resp = Manager::split(response.text(), '/');
    //string dictionary= resp[0];
    //string decodedFile=resp[1];
    //debe llegar de la respuesta
    string dictionary="\n~0001| ~111|'~011100|(~0000110110|)~1001000001|,~0000111|?~1100100|A~100100011|B~100100001|D~00001011|H~0000100|I~110011|J~0000110111|M~1001000000|N~100100111|O~10010010|P~000011010|T~100100010|W~011110|Y~00001100|a~10101|b~00001010|c~1100101|d~10001|e~001|f~0111011|g~00000|h~11011|i~11010|k~011111|l~10000|m~100101|n~0101|o~1011|p~100100110|r~01000|s~10011|t~0110|u~10100|v~0111010|w~11000|y~01001|";
    string decodedFile="0000101100111001011011100010010001000011010101010100010101100101101101000001000100001001011110001111100101101010101111110011111100010011100101110101000100111111000110111010101100111001001111101000110100000011011011000010111101101100101011110100110111010001110001000001111110010110000101110100100011101001010000011110100100100110111100101010011111001011101001011000111001000001110011111110010110101010101110001101111100011010010111101001101110100010001111000010111001111010010100000111011101111010000001101101100001100100011100001000011101101101100111101101101010010100100011001001111011010001111100101101010101111110011111001011101000101000111101111000010111111000110111010101100111001001111110010111010010100100010111101101100101011110100110111010001110001000001111101011000011000101010100110011111011010101011111110100101000001111001111010100010011001100011001000011010001101110100110111010011111000101101010111000110111011010101011111001111101011100010101010011111001010100111110010011001000110101000100100011001001111011000011111101011011011011101101101111010100111110110110101001010010001100100111101101101110110110111101010011111011011010100101001000100001001011110001111000111010100011111100000111100000001011011111011001010000010001011110110110010101111110011111101001001100110001111011010111110111110101101111000111010011011101001111001110111111100000110000100001100100000100001001011110001111000111010100011111100000111100000001011011111011001010000011100100000101111000110000100000000111111110011111011011011110100101011111111110011111011111010110111100000011001000101101100111101100100010100011011011111110101001111111011110101000111010010100000111110100101111010011011101000100011100101001001100110001100100011010110001111110100110011100100111111101110101010100000110100101000001111011010111101001101110100010001110110101101010000010100001000100001101111010010011011011100001010101111010100001101001010000011111010010111110010101001111000010101000010111011100010001100100001101000110111010011011101001110110110111101001010111111110110110111010101101111100111111100101101010101011100011011110011001001000101111011011101010110111011111110100101100011111011011101111110010110101010111101101101110101011011101001101110100111101010100000100011100110111011111010011011101000111000100000111110101111100101101010101111101010110111101011000010000000101111000110000100000000111111110011111110001101010000100001110111011110100000010100010000011110110110111101010011111101101010011111011101000110000110010010010111110010101001111101111000010100011001001001011111001010100111110111100001010001000011011010010000000100111101101101110111010000000110110110100111110100110111010011111001011010101010111000110111100010011100101101110001001100100000100010000100101111000111100011101010001111110000011110000000101101111101100101000001000101111011011001010111111001111110100100110011000111101101011111011111010110111100011101001101110100111100111011111110000011000010000110010011100001100001101011101100010000100101111000111100011101010001111110000011110000000101101111101100101000001110010000010111100011000010000000011111111001111101101101111010010101111111111001111101111101011011110000001000010111011111010011011101001111001100100100010111101101110101011011111000001011100011101000111110001101101010011100100000101111000101110001110100011110000010110101001111101010101100011111001011010110001001111100111010011001011101111101110111011101110000100110001100100100111011111101110100010001001100110000011101000110011000100001011101111101001101110100111100110010010001011110110111010101101111100000101110001110100011111000110110101001110010000010111100010111000111010001111000001011010100111110101010110001111100101101011000100111110011101001100101110111110111011101110111000010011000110010010011101111110111010001000100110011000001110100011001100010000110000110101110110001000010010111100011110001110101000111111000001111000000010110111110110010100000100010111101101100101011111100111111010010011001100011110110101111101111101011011110001110100110111010011110011101111111000001100001000011001001110000110000110101110110000111111010010011010111011000011111101001001101011101100010111100011000010000000011111111011101111000111100011101010001111110000011110000000101101111101100101000001110010000010111101101100101011111100111111010010011001100011110110101111101111101011011110001110100110111010011110011101111111000001100001000011001000001110011111011011011110100101011111111110011111011111010110111100000011100111110110110111101001010111111111100111110111110101101111000000110010001011011001010000011111101010011111100111011100101001011011011110100101000000001110011111100110010011111101001011110100110111010000011100110110111100101110100000011011011011101111111010100001000011110010100100011100111111100010101010101101111101001101110110101111100001010001111011001000101000010001";
    
    writeFile(file,decode(dictionary,decodedFile));
    cout << url <<endl;
}
void Manager::reset(string file)
{
    string url = http+"newest/"+file;
    //auto response = cpr::Post(cpr::Url{url);
    //std::cout << response.text << std::endl;
    //vector<string> resp = Manager::split(response.text(), '/');
    //string dictionary= resp[0];
    //string decodedFile=resp[1];
    //debe llegar de la respuesta
    string dictionary="\n~0001| ~111|'~011100|(~0000110110|)~1001000001|,~0000111|?~1100100|A~100100011|B~100100001|D~00001011|H~0000100|I~110011|J~0000110111|M~1001000000|N~100100111|O~10010010|P~000011010|T~100100010|W~011110|Y~00001100|a~10101|b~00001010|c~1100101|d~10001|e~001|f~0111011|g~00000|h~11011|i~11010|k~011111|l~10000|m~100101|n~0101|o~1011|p~100100110|r~01000|s~10011|t~0110|u~10100|v~0111010|w~11000|y~01001|";
    string decodedFile="0000101100111001011011100010010001000011010101010100010101100101101101000001000100001001011110001111100101101010101111110011111100010011100101110101000100111111000110111010101100111001001111101000110100000011011011000010111101101100101011110100110111010001110001000001111110010110000101110100100011101001010000011110100100100110111100101010011111001011101001011000111001000001110011111110010110101010101110001101111100011010010111101001101110100010001111000010111001111010010100000111011101111010000001101101100001100100011100001000011101101101100111101101101010010100100011001001111011010001111100101101010101111110011111001011101000101000111101111000010111111000110111010101100111001001111110010111010010100100010111101101100101011110100110111010001110001000001111101011000011000101010100110011111011010101011111110100101000001111001111010100010011001100011001000011010001101110100110111010011111000101101010111000110111011010101011111001111101011100010101010011111001010100111110010011001000110101000100100011001001111011000011111101011011011011101101101111010100111110110110101001010010001100100111101101101110110110111101010011111011011010100101001000100001001011110001111000111010100011111100000111100000001011011111011001010000010001011110110110010101111110011111101001001100110001111011010111110111110101101111000111010011011101001111001110111111100000110000100001100100000100001001011110001111000111010100011111100000111100000001011011111011001010000011100100000101111000110000100000000111111110011111011011011110100101011111111110011111011111010110111100000011001000101101100111101100100010100011011011111110101001111111011110101000111010010100000111110100101111010011011101000100011100101001001100110001100100011010110001111110100110011100100111111101110101010100000110100101000001111011010111101001101110100010001110110101101010000010100001000100001101111010010011011011100001010101111010100001101001010000011111010010111110010101001111000010101000010111011100010001100100001101000110111010011011101001110110110111101001010111111110110110111010101101111100111111100101101010101011100011011110011001001000101111011011101010110111011111110100101100011111011011101111110010110101010111101101101110101011011101001101110100111101010100000100011100110111011111010011011101000111000100000111110101111100101101010101111101010110111101011000010000000101111000110000100000000111111110011111110001101010000100001110111011110100000010100010000011110110110111101010011111101101010011111011101000110000110010010010111110010101001111101111000010100011001001001011111001010100111110111100001010001000011011010010000000100111101101101110111010000000110110110100111110100110111010011111001011010101010111000110111100010011100101101110001001100100000100010000100101111000111100011101010001111110000011110000000101101111101100101000001000101111011011001010111111001111110100100110011000111101101011111011111010110111100011101001101110100111100111011111110000011000010000110010011100001100001101011101100010000100101111000111100011101010001111110000011110000000101101111101100101000001110010000010111100011000010000000011111111001111101101101111010010101111111111001111101111101011011110000001000010111011111010011011101001111001100100100010111101101110101011011111000001011100011101000111110001101101010011100100000101111000101110001110100011110000010110101001111101010101100011111001011010110001001111100111010011001011101111101110111011101110000100110001100100100111011111101110100010001001100110000011101000110011000100001011101111101001101110100111100110010010001011110110111010101101111100000101110001110100011111000110110101001110010000010111100010111000111010001111000001011010100111110101010110001111100101101011000100111110011101001100101110111110111011101110111000010011000110010010011101111110111010001000100110011000001110100011001100010000110000110101110110001000010010111100011110001110101000111111000001111000000010110111110110010100000100010111101101100101011111100111111010010011001100011110110101111101111101011011110001110100110111010011110011101111111000001100001000011001001110000110000110101110110000111111010010011010111011000011111101001001101011101100010111100011000010000000011111111011101111000111100011101010001111110000011110000000101101111101100101000001110010000010111101101100101011111100111111010010011001100011110110101111101111101011011110001110100110111010011110011101111111000001100001000011001000001110011111011011011110100101011111111110011111011111010110111100000011100111110110110111101001010111111111100111110111110101101111000000110010001011011001010000011111101010011111100111011100101001011011011110100101000000001110011111100110010011111101001011110100110111010000011100110110111100101110100000011011011011101111111010100001000011110010100100011100111111100010101010101101111101001101110110101111100001010001111011001000101000010001";
    
    writeFile(file,decode(dictionary,decodedFile));

    cout << url <<endl;
}
void Manager::sync(string file)
{
    
    string url = http+"newest/"+file;
    //auto response = cpr::Post(cpr::Url{url);
    //std::cout << response.text << std::endl; 
    //vector<string> resp = Manager::split(response.text(), '/');
    //string dictionary= resp[0];
    //string decodedFile=resp[1];
    string dictionary="\n~0001| ~111|'~011100|(~0000110110|)~1001000001|,~0000111|?~1100100|A~100100011|B~100100001|D~00001011|H~0000100|I~110011|J~0000110111|M~1001000000|N~100100111|O~10010010|P~000011010|T~100100010|W~011110|Y~00001100|a~10101|b~00001010|c~1100101|d~10001|e~001|f~0111011|g~00000|h~11011|i~11010|k~011111|l~10000|m~100101|n~0101|o~1011|p~100100110|r~01000|s~10011|t~0110|u~10100|v~0111010|w~11000|y~01001|";
    string decodedFile="0000101100111001011011100010010001000011010101010100010101100101101101000001000100001001011110001111100101101010101111110011111100010011100101110101000100111111000110111010101100111001001111101000110100000011011011000010111101101100101011110100110111010001110001000001111110010110000101110100100011101001010000011110100100100110111100101010011111001011101001011000111001000001110011111110010110101010101110001101111100011010010111101001101110100010001111000010111001111010010100000111011101111010000001101101100001100100011100001000011101101101100111101101101010010100100011001001111011010001111100101101010101111110011111001011101000101000111101111000010111111000110111010101100111001001111110010111010010100100010111101101100101011110100110111010001110001000001111101011000011000101010100110011111011010101011111110100101000001111001111010100010011001100011001000011010001101110100110111010011111000101101010111000110111011010101011111001111101011100010101010011111001010100111110010011001000110101000100100011001001111011000011111101011011011011101101101111010100111110110110101001010010001100100111101101101110110110111101010011111011011010100101001000100001001011110001111000111010100011111100000111100000001011011111011001010000010001011110110110010101111110011111101001001100110001111011010111110111110101101111000111010011011101001111001110111111100000110000100001100100000100001001011110001111000111010100011111100000111100000001011011111011001010000011100100000101111000110000100000000111111110011111011011011110100101011111111110011111011111010110111100000011001000101101100111101100100010100011011011111110101001111111011110101000111010010100000111110100101111010011011101000100011100101001001100110001100100011010110001111110100110011100100111111101110101010100000110100101000001111011010111101001101110100010001110110101101010000010100001000100001101111010010011011011100001010101111010100001101001010000011111010010111110010101001111000010101000010111011100010001100100001101000110111010011011101001110110110111101001010111111110110110111010101101111100111111100101101010101011100011011110011001001000101111011011101010110111011111110100101100011111011011101111110010110101010111101101101110101011011101001101110100111101010100000100011100110111011111010011011101000111000100000111110101111100101101010101111101010110111101011000010000000101111000110000100000000111111110011111110001101010000100001110111011110100000010100010000011110110110111101010011111101101010011111011101000110000110010010010111110010101001111101111000010100011001001001011111001010100111110111100001010001000011011010010000000100111101101101110111010000000110110110100111110100110111010011111001011010101010111000110111100010011100101101110001001100100000100010000100101111000111100011101010001111110000011110000000101101111101100101000001000101111011011001010111111001111110100100110011000111101101011111011111010110111100011101001101110100111100111011111110000011000010000110010011100001100001101011101100010000100101111000111100011101010001111110000011110000000101101111101100101000001110010000010111100011000010000000011111111001111101101101111010010101111111111001111101111101011011110000001000010111011111010011011101001111001100100100010111101101110101011011111000001011100011101000111110001101101010011100100000101111000101110001110100011110000010110101001111101010101100011111001011010110001001111100111010011001011101111101110111011101110000100110001100100100111011111101110100010001001100110000011101000110011000100001011101111101001101110100111100110010010001011110110111010101101111100000101110001110100011111000110110101001110010000010111100010111000111010001111000001011010100111110101010110001111100101101011000100111110011101001100101110111110111011101110111000010011000110010010011101111110111010001000100110011000001110100011001100010000110000110101110110001000010010111100011110001110101000111111000001111000000010110111110110010100000100010111101101100101011111100111111010010011001100011110110101111101111101011011110001110100110111010011110011101111111000001100001000011001001110000110000110101110110000111111010010011010111011000011111101001001101011101100010111100011000010000000011111111011101111000111100011101010001111110000011110000000101101111101100101000001110010000010111101101100101011111100111111010010011001100011110110101111101111101011011110001110100110111010011110011101111111000001100001000011001000001110011111011011011110100101011111111110011111011111010110111100000011100111110110110111101001010111111111100111110111110101101111000000110010001011011001010000011111101010011111100111011100101001011011011110100101000000001110011111100110010011111101001011110100110111010000011100110110111100101110100000011011011011101111111010100001000011110010100100011100111111100010101010101101111101001101110110101111100001010001111011001000101000010001";
    
    writeFile("ServerFile.txt",decode(dictionary,decodedFile));

    cout << "Cambios:" <<endl;
    string out = cmdOutput("diff -q "+file+" ServerFile.txt");
    if(out==""){
        cout << "¡El archivo está actualizado!" <<endl;
    }
    else
    {
        string comando="vimdiff " +file + " ServerFile.txt";
        system(comando.c_str());
    }
    
    
    cout << url <<endl;
}

void Manager::befriend(string name)
{
    string url = http+"befriend/"+name;
    //auto response = cpr::Post(cpr::Url{url);
    //std::cout << response.text << std::endl;
    cout << url <<endl;
}


void Manager::hello()
{
    //vector<string> vec=encode(getFileContent("Archivo1.txt"));
    //decode(vec[0],vec[1]);
    
    writeFile("example.txt", getFileContent("Archivo2.txt"));
    cout << "hello!" << endl;
}